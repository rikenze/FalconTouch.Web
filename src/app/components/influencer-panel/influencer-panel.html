<app-notification
  [show]="showNotificationDialog"
  [message]="notificationMessage"
  [type]="notificationType"
  (dismiss)="showNotificationDialog = false">
</app-notification>

<div *ngIf="auth.isAdmin$ | async" class="admin-panel">

  <h2>{{ editMode ? 'Editar' : 'Cadastrar' }} Influenciador</h2>

    <form [formGroup]="influencerForm" (ngSubmit)="submitInfluencer()" class="form-block">
        <label for="name">Nome:</label>
        <input id="name" type="text" formControlName="name" required />
        <small class="error" *ngIf="influencerForm.get('name')?.invalid && influencerForm.get('name')?.touched">
            Nome √© obrigat√≥rio.
        </small>

        <label for="code">C√≥digo:</label>
        <input id="code" type="text" formControlName="code" required />
        <small class="error" *ngIf="influencerForm.get('code')?.invalid && influencerForm.get('code')?.touched">
            C√≥digo √© obrigat√≥rio.
        </small>

        <label for="discount">Desconto (%):</label>
        <input id="discount" type="number" formControlName="discount_percent" step="1" min="0" max="100" required />
        <small class="error" *ngIf="influencerForm.get('discount_percent')?.invalid && influencerForm.get('discount_percent')?.touched">
            Desconto √© obrigat√≥rio.
        </small>

        <label for="commission_type">Tipo de Comiss√£o:</label>
        <select id="commission_type" formControlName="commission_type" required>
            <option value="per_player">R$ por jogador</option>
            <option value="prize">Pr√™mio por meta</option>
        </select>
        <small class="error" *ngIf="influencerForm.get('commission_type')?.invalid && influencerForm.get('commission_type')?.touched">
            Tipo de comiss√£o √© obrigat√≥rio.
        </small>

        <label for="commission_value">Valor (R$):</label>
        <input id="commission_value" type="number" formControlName="commission_value" step="0.01" min="0" [disabled]="isPrizeCommission" required />
        <small class="error" *ngIf="influencerForm.get('commission_value')?.invalid && influencerForm.get('commission_value')?.touched">
            Valor da comiss√£o √© obrigat√≥rio.
        </small>

        <label for="follower_count">Seguidores:</label>
        <input id="follower_count" type="number" formControlName="follower_count" min="0" required />
        <small class="error" *ngIf="influencerForm.get('follower_count')?.invalid && influencerForm.get('follower_count')?.touched">
            N√∫mero de seguidores √© obrigat√≥rio.
        </small>

        <label for="minimum_follower_percentage">Meta (%):</label>
        <input id="minimum_follower_percentage" type="number" formControlName="minimum_follower_percentage" min="0" required />
        <small class="error" *ngIf="influencerForm.get('minimum_follower_percentage')?.invalid && influencerForm.get('minimum_follower_percentage')?.touched">
            Meta de seguidores √© obrigat√≥rio.
        </small>

        <label for="active">Ativo:</label>
        <input id="active" type="checkbox" formControlName="active" />

        <button type="submit" class="btn-primary">
            {{ editMode ? 'Atualizar' : 'Cadastrar' }}
        </button>

        <button
            type="button"
            class="btn-secondary"
            (click)="resetForm()"
            *ngIf="editMode"
            style="margin-top: 0.5rem;">
            Cancelar
        </button>
    </form>
  <hr />

  <h3>Influenciadores Cadastrados</h3>
  <table class="influencer-table">
    <thead>
      <tr>
        <th>Nome</th>
        <th>C√≥digo</th>
        <th>Desconto (%)</th>
        <th>Comiss√£o</th>
        <th>Valor (R$)</th>
        <th>Seguidores</th>
        <th>Meta (%)</th>
        <th>Ativo</th>
        <th>Convers√µes</th>
        <th>A√ß√µes</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let influencer of influencers">
        <td>{{ influencer.name }}</td>
        <td>{{ influencer.code }}</td>
        <td>{{ influencer.discount_percent }}</td>
        <td>{{ influencer.commission_type === 'per_player' ? 'R$/jogador' : 'Pr√™mio' }}</td>
        <td>{{ influencer.commission_value | number:'1.2-2' }}</td>
        <td>{{ influencer.follower_count }}</td>
        <td>{{ influencer.minimum_follower_percentage }}</td>
        <td>{{ influencer.active ? 'Sim' : 'N√£o' }}</td>
        <td>
          <strong>
            {{ influencer.paidCount }} / {{ influencer.conversionGoal }}
          </strong>
          <br />
          <small 
            [style.color]="influencer.conversionStatus === 'Meta Atingida' ? 'green' : 'red'">
            <span *ngIf="influencer.conversionStatus === 'Meta Atingida'">‚úÖ</span>
            <span *ngIf="influencer.conversionStatus !== 'Meta Atingida'">‚ö†Ô∏è</span>
            {{ influencer.conversionStatus || 'Sem meta definida' }}
          </small>
          <br />
          <small>Total seguidores: {{ influencer.follower_count }}</small>
        </td>

        <td>
          <button type="button" (click)="editInfluencer(influencer)" class="edit" style="background-color: var(--warning); color: black;">
            ‚úèÔ∏è
          </button>
          <button type="button" (click)="deleteInfluencer(influencer.id)" class="delete" style="background-color: var(--danger);">
            üóëÔ∏è
          </button>
        </td>
      </tr>
    </tbody>
  </table>

</div>
